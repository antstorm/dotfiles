# Convenience method for accessing heroku
# usage examples:
# - shopa console
# - shopa config staging
# - shopa logs dev --tail
# - shopa sql 'SELECT * FROM users LIMIT 1'
# - shopa dump production.sql

function shopa {
  local task=$1
  local app_name="shopadotcom"

  shift

  if [[ "$1" == "dev" || "$1" == "staging" ]]; then
    app_name="$app_name-$1"
    shift
  else
    printf "WARNING! You are trying to access production environment.\n"
    printf "Sure you wanna do this? Type 'yes' to continue: "

    read -r response

    if [[ $response != "yes" ]]; then
      return
    fi
  fi

  case $task in
    (console) heroku run console --app $app_name                                                                                       ;;
    (restart) heroku restart --app $app_name                                                                                           ;;
    (config)  heroku config --app $app_name                                                                                            ;;
    (logs)    heroku logs $* --app $app_name                                                                                           ;;
    (sql)     heroku config --app $app_name | grep DATABASE_URL | awk '{ gsub(/\?.*/, ""); print $2 }' | xargs -I url psql url -c $*   ;;
    (dump)    heroku config --app $app_name | grep DATABASE_URL | awk '{ gsub(/\?.*/, ""); print $2 }' | xargs -I url pg_dump url > $* ;;
  esac
}
